<mat-card class="upload-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>cloud_upload</mat-icon>
      Upload de Arquivos
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <!-- Area de drag and drop -->
    <div
      class="drop-zone"
      [class.drag-over]="dragOver"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      (click)="fileInput.click()"
    >
      <mat-icon class="upload-icon">cloud_upload</mat-icon>
      <p class="upload-text">Arraste arquivos aqui ou clique para selecionar</p>
      <p class="upload-hint">PDF, PNG, JPG, DOC ou DOCX (max 10MB)</p>

      <input
        #fileInput
        type="file"
        multiple
        accept=".pdf,.png,.jpg,.jpeg,.doc,.docx"
        (change)="onFileSelected($event)"
        style="display: none"
      />
    </div>

    <!-- Lista de arquivos selecionados -->
    <div *ngIf="arquivosSelecionados.length > 0" class="arquivos-lista">
      <h3>Arquivos Selecionados:</h3>

      <div
        *ngFor="let arquivo of arquivosSelecionados; let i = index"
        class="arquivo-item"
      >
        <div class="arquivo-info">
          <mat-icon>insert_drive_file</mat-icon>
          <div class="arquivo-detalhes">
            <span class="arquivo-nome">{{ arquivo.name }}</span>
            <span class="arquivo-tamanho">{{
              getTamanhoFormatado(arquivo.size)
            }}</span>
          </div>
        </div>

        <!-- Progresso de upload -->
        <mat-progress-bar
          *ngIf="uploadsEmProgresso.has(arquivo.name)"
          mode="determinate"
          [value]="getProgresso(arquivo.name)"
        >
        </mat-progress-bar>

        <button
          mat-icon-button
          color="warn"
          (click)="removerArquivo(i)"
          [disabled]="uploadsEmProgresso.has(arquivo.name)"
          matTooltip="Remover arquivo"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <!-- Configuracoes do anexo -->
    <div class="upload-config" *ngIf="arquivosSelecionados.length > 0">
      <mat-form-field appearance="outline" class="tipo-field">
        <mat-label>Tipo de Anexo</mat-label>
        <mat-select [(ngModel)]="tipoAnexo">
          <mat-option *ngFor="let tipo of tiposAnexo" [value]="tipo.valor">
            {{ tipo.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="descricao-field">
        <mat-label>Descricao (Opcional)</mat-label>
        <input
          matInput
          [(ngModel)]="descricao"
          placeholder="Ex: Laudo de hemograma completo"
          maxlength="500"
        />
        <mat-hint align="end">{{ descricao.length }}/500</mat-hint>
      </mat-form-field>
    </div>
  </mat-card-content>

  <mat-card-actions *ngIf="arquivosSelecionados.length > 0">
    <button
      mat-raised-button
      color="primary"
      (click)="fazerUpload()"
      [disabled]="temUploadsEmProgresso()"
    >
      <mat-icon>cloud_upload</mat-icon>
      Enviar {{ arquivosSelecionados.length }} arquivo(s)
    </button>

    <button mat-button (click)="limpar()" [disabled]="temUploadsEmProgresso()">
      <mat-icon>clear</mat-icon>
      Limpar
    </button>
  </mat-card-actions>
</mat-card>

<!-- Template de upload de anexos -->
<!-- Drag and drop, selecao multipla, barra de progresso -->
<!-- Validacao de tipo e tamanho de arquivo -->
<!--    __  ____ ____ _  _ -->
<!--  / _\/ ___) ___) )( \ -->
<!-- /    \___ \___ ) \/ ( -->
<!-- \_/\_(____(____|____/ -->
